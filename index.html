<!DOCTYPE html>
<html>
  <head>
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
  </head>
  <body>
    <script>
      var tweetCounter;
      $(document).ready(function(){
        var $body = $('body');
        $body.html('<nav class="fixed-nav-bar">\
                    <div class="menu">\
                    <ul class="menu-items">\
                          <li><a href="#" class="update">Update Feed</a></li>\
                          <li><a href="#" class="live">Live Mode</a></li>\
                      </ul>\
                    </div>\
                  </nav>\
                  <div class="content">\
                  </div>')
        var $navBar = $('.fixed-nav-bar');
        var $menu = $('.menu');
        var $content = $('.content');
        var $menuItems = $('.menu-items');
        var $menuLi = $('li');
        var $links = $('a');
        $body.css({'background-size': 'cover',
                   'background-color': '#272727'});
        $menu.css({'width': '95%',
                   'height': '60px',
                   'margin': '0 auto'});
        $navBar.css({'position': 'fixed',
                    'top': '-10px',
                    'left': '0',
                    'z-index': '9999',
                    'width': '100%',
                    'height': '60px',
                    'line-height': '70px',
                    'background-color': '#000',
                    'border-radius': '15px'});
        $menuItems.css({'display': 'inline-block',
                    'margin': '0',
                    'padding': '0',
                    'border': '0',
                    'float': 'right',
                    'font-size': '25px'});
        $menuLi.css({'display': 'inline-block',
                    'margin-right': '10px',
                    'margin-left': '10px'});
        $links.css({'text-decoration': 'none',
                    'color': '#808080'});
        $content.css({'margin-top': '55px'});

        var userStyles = {douglascalhoun: {bkgrnd: '#808080', color: 'white'},
                          mracus: {bkgrnd: '#BECACF', color: 'black'},
                          shawndrost: {bkgrnd: '#DEDEDE', color: '#258028'},
                          sharksforcheap: {bkgrnd: '#B6C3A2', color: '#733838'}};
        function printTweets() {
          var index = streams.home.length - 1;
          tweetCounter = streams.home.length;
          while(index >= 0){
            var tweet = streams.home[index];
            var $tweet = $('<div class="' + tweet.user + '"></div>');
  /* Time-stamp to use later on in tweet div */
            var timestamp = '';
            if (tweet.created_at.getHours() > 12) {
              timestamp += (tweet.created_at.getHours() - 12) + ':'
              + ('0' + tweet.created_at.getMinutes()).slice(-2) + 'pm';
            } else {
              timestamp += tweet.created_at.getHours() + ':'
              + ('0' + tweet.created_at.getMinutes()).slice(-2) + 'am';
            }
  /* End time-stamp creation/formatting code */
            $tweet.text('@' + tweet.user + ': ' + tweet.message + ' - ' + timestamp);
            $tweet.css({'font-size': '18px',
                        'width': '95%',
                        'color': userStyles[tweet.user].color,
                        'background-color': userStyles[tweet.user].bkgrnd,
                        'padding': '15px',
                        'margin': '10px auto',
                        'border-radius': '10px'
                  });
            $tweet.appendTo($content);
            index -= 1;
          }
        };
        printTweets();
        function updateTweets() {
          var $recentTweet = $('.content div')[0];
          var tweetCount = streams.home.length - tweetCounter;
          var newestTweetIndex = streams.home.length - 1;
          for (var i = tweetCount; i > 0; i--) {
            var tweet = streams.home[newestTweetIndex];
            newestTweetIndex--;
            var $tweet = $('<div class="' + tweet.user + '"></div>');
  /* Time-stamp to use later on in tweet div */
            var timestamp = '';
            if (tweet.created_at.getHours() > 12) {
              timestamp += (tweet.created_at.getHours() - 12) + ':'
              + ('0' + tweet.created_at.getMinutes()).slice(-2) + 'pm';
            } else {
              timestamp += tweet.created_at.getHours() + ':'
              + ('0' + tweet.created_at.getMinutes()).slice(-2) + 'am';
            }
  /* End time-stamp creation/formatting code */
            $tweet.text('@' + tweet.user + ': ' + tweet.message + ' - ' + timestamp);
            $tweet.css({'font-size': '18px',
                        'width': '95%',
                        'color': userStyles[tweet.user].color,
                        'background-color': userStyles[tweet.user].bkgrnd,
                        'padding': '15px',
                        'margin': '10px auto',
                        'border-radius': '10px'
                  });
            $($tweet.insertBefore($recentTweet)).on('click', function(){userTimeline( $(this).attr("class") )});

          }
        };
        function userTimeline(username) {
          var userTweets = streams.users[username];
          var index = userTweets.length - 1;
          $($content).empty();
          while (index > 0) {
            var tweet = userTweets[index];
            var $tweet = $('<div class="' + userTweets[index].user + '"></div>');
  /* Time-stamp to use later on in tweet div */
            var timestamp = '';
            if (tweet.created_at.getHours() > 12) {
              timestamp += (tweet.created_at.getHours() - 12) + ':'
              + ('0' + tweet.created_at.getMinutes()).slice(-2) + 'pm';
            } else {
              timestamp += tweet.created_at.getHours() + ':'
              + ('0' + tweet.created_at.getMinutes()).slice(-2) + 'am';
            }
  /* End time-stamp creation/formatting code */
            $tweet.text('@' + tweet.user + ': ' + tweet.message + ' - ' + timestamp);
            $tweet.css({'font-size': '18px',
                        'width': '95%',
                        'color': userStyles[tweet.user].color,
                        'background-color': userStyles[tweet.user].bkgrnd,
                        'padding': '15px',
                        'margin': '10px auto',
                        'border-radius': '10px'
                  });
            $tweet.appendTo($content);
            index -= 1;
          }
        }
        $('.update').on('click', updateTweets);
        $('.live').on('click', function(){console.log('this should be live mode')});
        $('.content > div').on('click', function(){ userTimeline($(this).attr("class")) });
      });
    </script>
  </body>
</html>
