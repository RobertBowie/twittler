<!DOCTYPE html>
<html>
  <head>
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
  </head>
  <body>
    <script>
      var visitor = "Guest";
      var tweetCounter;
      $(document).ready(function(){
        var $body = $('body');
        $body.html('<nav class="fixed-nav-bar">\
                    <div class="logo">\
                    </div>\
                    <div class="menu">\
                    <input type="text" id="one" placeholder=" Join the conversation" />\
                    <input type="button" id="submitButton" value="Submit">\
                    <ul class="menu-items">\
                          <li><a href="#" class="update">Update Feed</a></li>\
                          <li><a href="#" class="live">Live Mode</a></li>\
                      </ul>\
                    </div>\
                  </nav>\
                  <div class="content">\
                  </div>')
        var $navBar = $('.fixed-nav-bar');
        var $menu = $('.menu');
        var $logo = $('.logo');
        var $textInput = $('#one');
        var $submitButton = $('#submitButton');
        var $content = $('.content');
        var $menuItems = $('.menu-items');
        var $menuLi = $('li');
        var $links = $('a');
        $body.css({'background-size': 'cover',
                   'background-color': '#272727'});
        $menu.css({'width': '95%',
                   'height': '60px',
                   'margin': '0 auto'});
        $textInput.css({'margin-left': '20px',
                    'margin-right': '3px',
                    'height': '25px',
                    'border-radius': '3px',
                    'font-size': 'larger',
                    'background-color': '#2B2B2B',
                    'color': '#A9A9A1',
                    'outline': '0'});
        $submitButton.css({'height': '31px',
                    'border-radius': '3px',
                    'font-size': 'larger'})
        $navBar.css({'position': 'fixed',
                    'top': '-10px',
                    'left': '0',
                    'z-index': '9999',
                    'width': '100%',
                    'height': '60px',
                    'line-height': '70px',
                    'background-color': '#000',
                    'border-radius': '15px'});
        $logo.css({'content':'url(twitterlike-bird.png)',
                    'float': 'left',
                    'margin-top': '9px',
                    'margin-left': '5px',
                    'border-radius': '10px'});
        $menuItems.css({'display': 'inline-block',
                    'margin': '0',
                    'padding': '0',
                    'border': '0',
                    'float': 'right',
                    'font-size': '25px'});
        $menuLi.css({'display': 'inline-block',
                    'margin-right': '10px',
                    'margin-left': '10px'});
        $links.css({'text-decoration': 'none',
                    'color': '#808080'});
        $content.css({'margin-top': '55px'});

        var userStyles = {douglascalhoun: {bkgrnd: '#808080', color: 'white'},
                          mracus: {bkgrnd: '#BECACF', color: 'black'},
                          shawndrost: {bkgrnd: '#DEDEDE', color: '#258028'},
                          sharksforcheap: {bkgrnd: '#B6C3A2', color: '#733838'},
                          Guest: {bkgrnd: '#000', color : 'red'}};

        function buildTimeStamp(time) {
          var timestamp = '';
          // var timeObj = {};
          if (time.getHours() > 12) {
            timestamp += (time.getHours() - 12) + ':'
            + ('0' + time.getMinutes()).slice(-2) + 'pm';
          } else {
            timestamp += (time.getHours() || 12) + ':'
            + ('0' + time.getMinutes()).slice(-2) + 'am';
          }
          return timestamp;
        };
        function printTweets() {
          var index = streams.home.length - 1;
          tweetCounter = streams.home.length;
          while(index >= 0){
            var tweet = streams.home[index];
            var time = tweet.created_at;
            var $tweet = $('<div class="' + tweet.user + '"></div>');
            var $timestamp = $('<div>' + buildTimeStamp(time) + '</div>');
            $timestamp.css({'float': 'right'});
            $tweet.text('@' + tweet.user + ': ' + tweet.message);
            $tweet.css({'font-size': '18px',
                        'width': '95%',
                        'color': userStyles[tweet.user].color,
                        'background-color': userStyles[tweet.user].bkgrnd,
                        'padding': '15px',
                        'margin': '10px auto',
                        'border-radius': '10px'
                  });
            var $addTo = $tweet.appendTo($content);
            $addTo.append($timestamp);
            index -= 1;
          }
        };
        printTweets();
        function updateTweets() {
          var $recentTweet = $('.content div')[0];
          var tweetCount = streams.home.length - tweetCounter;
          var newestTweetIndex = streams.home.length - 1;
          for (var i = tweetCount; i > 0; i--) {
            var tweet = streams.home[newestTweetIndex];
            var time = tweet.created_at;
            newestTweetIndex--;
            var $tweet = $('<div class="' + tweet.user + '"></div>');
            var $timestamp = $('<div>' + buildTimeStamp(time) + '</div>');
            $timestamp.css({'float': 'right'});
            $tweet.text('@' + tweet.user + ': ' + tweet.message);
            $tweet.css({'font-size': '18px',
                        'width': '95%',
                        'color': userStyles[tweet.user].color,
                        'background-color': userStyles[tweet.user].bkgrnd,
                        'padding': '15px',
                        'margin': '10px auto',
                        'border-radius': '10px'
                  });
            var $addTo = $($tweet.insertBefore($recentTweet)).on('click', function(){userTimeline( $(this).attr("class") )});
            $addTo.append($timestamp);
          }
        };
        function userTimeline(username) {
          liveMode = false;
          var userTweets = streams.users[username];
          var index = userTweets.length - 1;
          $($content).empty();
          while (index >= 0) {
            var tweet = userTweets[index];
            var time = tweet.created_at;
            var $tweet = $('<div class="' + userTweets[index].user + '"></div>');
            var $timestamp = $('<div>' + buildTimeStamp(time) + '</div>');
            $timestamp.css({'float': 'right'});
            $tweet.text('@' + tweet.user + ': ' + tweet.message);
            $tweet.css({'font-size': '18px',
                        'width': '95%',
                        'color': userStyles[tweet.user].color,
                        'background-color': userStyles[tweet.user].bkgrnd,
                        'padding': '15px',
                        'margin': '10px auto',
                        'border-radius': '10px'
                  });
            var $addTo = $($tweet.appendTo($content));
            $addTo.append($timestamp);
            index -= 1;
          }
        }
        $('.update').on('click', updateTweets);
        var liveMode = false;
        setInterval(function(){ if(liveMode) {
            updateTweets();
          }
        }, 1000);
        $('.live').on('click', function(){ if(liveMode) {liveMode = false} else { liveMode = true } });
        $('.content > div').on('click', function(){ userTimeline($(this).attr("class")) });
        $submitButton.on('click', function(){ writeTweet($textInput.val()); $textInput.val('') });
      });
    </script>
  </body>
</html>
